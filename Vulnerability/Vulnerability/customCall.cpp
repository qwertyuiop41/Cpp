#include <Windows.h>
#include <iostream>

//__declspec 是 MSVC 的扩展关键字
void _declspec(naked) shellcode() {
	//不需要手动push返回地址，call会自动把return地址压入栈中
	_asm {
		//41hook 34 31 68 6F 6F 6B
		push 0x00006B6F
		push 0x6F683134
		mov eax,esp
		push 0 //uType
		push 0 //uType
		push eax //lpText
		push 0 //lpText
		mov ebx, 0x75601490 //MessageBoxA 地址
		call ebx
		mov ebx, 0x761F9BEB //ExitProcess 地址-》来自 kernel32.dll
		push 0 //uExitCode = 0，表示正常退出
		call ebx
	}
}

int main2() {
	printf("51hook\n");
	//因为 MessageBoxA 是 user32.dll 中的导出函数
	//必须先 LoadLibraryA("user32.dll")，让系统把这个 DLL 加载到内存中，才能使用 GetProcAddress 找到它的地址，或者直接调用它。
	LoadLibraryA("user32.dll");
	shellcode();

	return 0;
}

